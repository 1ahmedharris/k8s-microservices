# This file defines your server block, root directory, index file,
# security headers, and browser caching settings.

server {
    # Listen on port 80 for plain HTTP traffic inside the container.
    # Kubernetes Services will forward traffic here.
    listen 80;

    # Set the document root to where your static files will be copied in the Dockerfile.
    root /usr/share/nginx/html;

    # Specify the default file to serve for directory requests.
    index index.html;

    # --- MAIN LOCATION BLOCK ---
    # Handles all requests.
    location / {
        # client-side routing
        try_files $uri $uri/ /index.html;

        # check against cloudfront 
        add_header X-Content-Type-Options "nosniff" always; # Prevents MIME sniffing
        add_header X-Frame-Options "DENY" always;         # Prevents clickjacking
        add_header Referrer-Policy "strict-origin-when-cross-origin" always; 
        add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), \
                              payment=(), midi=(), usb=(), gamepad=(), \
                              gyroscope=(), accelerometer=(), magnetometer=(), \
                              display-capture=()" always;
    }

    # --- PERFORMANCE: BROWSER CACHING (and CloudFront Origin Caching) ---
    # This location block applies aggressive caching headers to your static assets.
    location ~* \.(css|js|ico|png|jpg|jpeg|gif|svg|woff|woff2|ttf|eot)$ { # Added html/htm
        # Tells browsers and proxies (like CloudFront) to cache these assets for one year.
        # CloudFront should be configured to "Use Origin Cache Headers" for these paths.
        expires 3M always;
        add_header Cache-Control "public, immutable" always;
    }
}
